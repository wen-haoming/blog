<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node基本 | 小明同学的学习笔记</title>
    <meta name="description" content="记录成长的点点滴滴,每周更新2-3篇">
    
    
    <link rel="preload" href="/assets/css/0.styles.a0ada997.css" as="style"><link rel="preload" href="/assets/js/app.f5468c75.js" as="script"><link rel="preload" href="/assets/js/2.91048ab8.js" as="script"><link rel="preload" href="/assets/js/13.81749b1d.js" as="script"><link rel="prefetch" href="/assets/js/10.c8278ad1.js"><link rel="prefetch" href="/assets/js/11.4a9ef7b1.js"><link rel="prefetch" href="/assets/js/12.a1851664.js"><link rel="prefetch" href="/assets/js/14.6ce2689a.js"><link rel="prefetch" href="/assets/js/15.fbc99851.js"><link rel="prefetch" href="/assets/js/16.aa632dd7.js"><link rel="prefetch" href="/assets/js/17.8690440c.js"><link rel="prefetch" href="/assets/js/18.1a9db272.js"><link rel="prefetch" href="/assets/js/19.343716d2.js"><link rel="prefetch" href="/assets/js/3.2509acab.js"><link rel="prefetch" href="/assets/js/4.e2e0255b.js"><link rel="prefetch" href="/assets/js/5.653dd45a.js"><link rel="prefetch" href="/assets/js/6.00c7e7f9.js"><link rel="prefetch" href="/assets/js/7.e0340969.js"><link rel="prefetch" href="/assets/js/8.2a65852f.js"><link rel="prefetch" href="/assets/js/9.2b5eecaa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0ada997.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小明同学的学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/node/base/this.html" class="nav-link">开始</a></div><div class="nav-item"><a href="https://github.com/wen-haoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/node/base/this.html" class="nav-link">开始</a></div><div class="nav-item"><a href="https://github.com/wen-haoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS基础知识巩固</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>异步编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>node专题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/1.html" class="active sidebar-link">node基本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/1.html#node基本" class="sidebar-link">node基本</a></li></ul></li><li><a href="/node/2.html" class="sidebar-link">node实现模块化原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器知识笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="node基本"><a href="#node基本" aria-hidden="true" class="header-anchor">#</a> node基本</h2> <h3 id="_1-node-基本概述"><a href="#_1-node-基本概述" aria-hidden="true" class="header-anchor">#</a> 1. node 基本概述</h3> <p>web 服务器的特点： 事件驱动，非阻塞io</p> <p>node的特点：异步io，事件驱动，单线程，</p> <ul><li>异步io： 极大提升运行效率</li> <li>事件驱动：函数是第一公民，回调函数是最好接受异步调用返回数据的方式</li> <li>单线程：js与其他线程无法共享状态，没有状态同步，死锁，也没有线程上下文交换所带来的性能上的开销。
<ul><li>缺点：</li> <li>1，无法利用多核cpu。</li> <li>2，错误会引起整个应用退出。</li> <li>3，大量cpu导致无法继续调用异步io。</li></ul></li> <li>跨平台</li></ul> <p>node是一个js的运行时，绝大多数操作都是异步方式进行调用，</p> <p>node 能干什么？</p> <p>​	写脚本代码，中间层，服务端渲染，前后端分离</p> <h3 id="_2-node进程和线程的区别-node中的进程-多核-开启子进程-pm2"><a href="#_2-node进程和线程的区别-node中的进程-多核-开启子进程-pm2" aria-hidden="true" class="header-anchor">#</a> 2. node进程和线程的区别 (node中的进程) 多核 开启子进程 pm2</h3> <p>一个进程中可以有多个线程，比如渲染线程、JS 引擎线程、HTTP 请求线程等等 ,进程表示一个程序，线程是进程中的单位  主线程只有一个</p> <p>1个进程可以占用1核cpu</p> <ul><li><p>多线程在单核cpu中其实也是顺序执行的，不过系统可以帮你切换那个执行而已，没有提高速度</p></li> <li><p>多核cpu的话就可以在多个cpu中同时执行</p></li></ul> <blockquote><p>单线程优点：解决切换上下文时间,锁的问题,节省内存 (多线程)</p></blockquote> <blockquote><p>node 主进程，在开多个子进程，里面包含着一个线程</p></blockquote> <h3 id="_3-node的global基本属性-常用"><a href="#_3-node的global基本属性-常用" aria-hidden="true" class="header-anchor">#</a> 3. node的global基本属性(常用))</h3> <ol><li>global 中的属性为全局属性。 在全局声明的</li> <li>默认this的指向为模块环境。this === module.exports (因为模块环境的this被改变)</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token function">以上为模块参数</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span>  __dirname<span class="token punctuation">,</span> __filename</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    process（进程） buffer（二进制数据）
    ckearInterval setInterval
    clearTimeout setTimeout
    clearImmediate setImmediate 宏任务
<span class="token comment">//  以上为global 参数</span>
</code></pre></div><h4 id="global-precess-进程属性"><a href="#global-precess-进程属性" aria-hidden="true" class="header-anchor">#</a> global.precess(进程属性)</h4> <ol><li><p><strong>precess.argv</strong> 为用户执行文件是传入的参数 node + 文件名  &lt; 参数 &gt;</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 需要从第二位开始截取
  <span class="token comment">//获取参数 使用reduce来对处理到我需要的对象</span>
  <span class="token keyword">let</span> config <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pre<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> pre
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</code></pre></div><p>使用commander 来自定义命令行
使用chalk 来自定义命令行颜色</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    npm i commander <span class="token operator">-</span><span class="token constant">D</span>
    
    <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span>
      最后都需要加入<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    
    <span class="token number">1.</span> 设置属性
    program<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">' -p , --port  &lt;val&gt; '</span><span class="token punctuation">,</span> <span class="token string">'set port '</span><span class="token punctuation">)</span>
    <span class="token number">1.</span> 设置命令
      program<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;haha&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token number">2.</span> 订阅输入某件事
      program<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token number">3.</span> cholk粉笔
        cholk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre></div><p>关于commander的命令参数可以看后续的文章讲解</p> <ol start="2"><li><p><strong>process.platform</strong> (查看node的平台参数)</p> <p>window =&gt; 32win</p> <p>mac =&gt; darwin</p></li> <li><p><strong>process.cwd</strong>(返回当前的执行的工作目录)</p></li></ol> <p>命令中在哪执行就在指向哪里</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 解析出一个绝对路径</span>
  process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在哪里执行这个文件,目录就是哪里,代表的就是执行的文件</span>
</code></pre></div><ol start="4"><li><p><strong>process.env</strong>(可以根据环境的不同执行不同的结果)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">export</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>prod <span class="token operator">&amp;&amp;</span> node xxx<span class="token punctuation">.</span>js
 那么当前的process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> prod
 <span class="token comment">// process.env.NODE_ENV = ‘develop’</span>
</code></pre></div></li> <li><p><strong>process.nextTick</strong>(node中的微任务)))</p> <p><strong>timer --&gt; poll --&gt;  check</strong></p> <p>node中的微任务</p> <p>宏任务 -&gt; <strong>setImmediate( fn )</strong>  vs  <strong>setTimeout</strong></p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>      ┌───────────────────────┐
  ┌─&gt; │        timers         │ 本阶段执行setTimeout() 和 setInterval() 
  │   └──────────┬────────────┘
  │   ┌──────────┴────────────┐
  │   │     I/O callbacks     │ 这个阶段执行一些诸如TCP错误之类的系统操作的回调
  │   └──────────┬────────────┘
  │   ┌──────────┴────────────┐
  │   │     idle, prepare     │ 只内部使用
  │   └──────────┬────────────┘      ┌───────────────┐
  │   ┌──────────┴────────────┐      │   incoming:   │
  │   │         poll          │  &lt;───┤  connections, │ 获取新的 I/O 事件,查找已经到时的定时器
  │   └──────────┬────────────┘      │   data, etc.  │
  │   ┌──────────┴────────────┐      └───────────────┘
  │   │        check          │ setImmediate()
  │   └──────────┬────────────┘
  │   ┌──────────┴────────────┐
  └──-┤    close callbacks    │ 关闭事件的回调 socket.close事件
      └──────────────────────—┘

      定时器：本阶段执行已经安排的 setTimeout() 和 setInterval() 的回调函数。
      待定回调：执行延迟到下一个循环迭代的 I/O 回调。
      idle, prepare：仅系统内部使用。
      轮询：检索新的 I/O 事件;执行与 I/O 相关的回调（几乎所有情况下，除了关闭的回调函数，它们由计时器和 setImmediate() 排定的之外），其余情况 node 将在此处阻塞。
      检测：setImmediate() 回调函数在这里执行。
      关闭的回调函数：一些准备关闭的回调函数，如：socket.on('close', ...)。
      
</code></pre></div><p><a href="https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/" target="_blank" rel="noopener noreferrer">node官方中文翻译<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>注意：如果只有setTimeout 0秒状态和setImmediate两个 有时候可能是setImmediate优先</p></blockquote> <blockquote><p>受node的性能影响，不一定谁先执行，但是<strong>setImmediate是在i/o之后立即执行</strong></p></blockquote> <blockquote><p>poll 和check 执行都会自动执行微任务</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/promise/4.html" class="prev">
          Promise相关的api实现
        </a></span> <span class="next"><a href="/node/2.html">
          node实现模块化原理
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f5468c75.js" defer></script><script src="/assets/js/2.91048ab8.js" defer></script><script src="/assets/js/13.81749b1d.js" defer></script>
  </body>
</html>
